package com.cs.study.signup.controller;

import java.util.List;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;

import com.cs.study.radioselect.service.DeptService;
import com.cs.study.radioselect.vo.DeptVO;
import com.cs.study.signup.service.SignupServiceKej;
import com.cs.study.signup.vo.SignupVOKej;

@Controller
public class SignupControllerKej2 {

    private final DeptService deptService;
    private final SignupServiceKej signupServiceKej;

    public SignupControllerKej2(DeptService deptService, SignupServiceKej signupServiceKej) {
        this.deptService = deptService;
        this.signupServiceKej = signupServiceKej;
    }

    @GetMapping("/signup/signupKej2")
    // íšŒì› ê°€ì… í™”ë©´ìœ¼ë¡œ ì´ë™~
    public String signupKej(Model model) {
    	// DEPT í…Œì´ë¸”ì—ì„œ ì»¬ëŸ¼ëª…ì´ dept_grp ì´ê³  ê·¸ ê°’ì´ signup_question ì¸ ì§ˆë¬¸ ê°€ì ¸ì˜¤ê¸°
    	DeptVO deptVO = new DeptVO();
    	// voì— ì§ˆë¬¸ ì»¬ëŸ¼ ê°’ì„ ë„£ìŒ   	
    	deptVO.setDeptGrp("signup_question");
    	//ë¦¬ìŠ¤íŠ¸ ë©”ì†Œë“œ í˜¸ì¶œ
    	List<DeptVO> deptQuestionList =  deptService.selectDeptList(deptVO);
    	model.addAttribute("deptQuestionList",deptQuestionList);
    	
    	// DEPT í…Œì´ë¸”ì—ì„œ whereì ˆ dept_grp =  signup_phoneì „í™”ë²ˆí˜¸ ì•ìë¦¬ ê°€ì ¸ì˜¤ê¸°
    	deptVO = new DeptVO();
    	deptVO.setDeptGrp("signup_phone");
    	List<DeptVO> deptTelList = deptService.selectDeptList(deptVO);
    	model.addAttribute("deptTelList",deptTelList);
    	
    	// DEPT í…Œì´ë¸”ì—ì„œ where ì¡°ê±´ dept_grp = signup_terms ì•½ê´€ ì•ìë¦¬ ê°€ì ¸ì˜¤ê¸°
    	deptVO = new DeptVO();
    	deptVO.setDeptGrp("signup_terms");
    	List<DeptVO> deptTermsList = deptService.selectDeptList(deptVO);
    	// ë¦¬ìŠ¤íŠ¸ê°€ ê°€ì§„ ê²ƒ ì¤‘ì—ì„œë„ ì»¬ëŸ¼ëª…ì´ dept_name ì´ê±° ì¸ ê²ƒë§Œ ê°€ì ¸ì˜¤ê¸°
    	if(deptTermsList.size() > 0) {
    		// deptTermsList.get(0) ì´ë ‡ê²Œ ê°€ì ¸ì˜¤ë©´ 0ë²ˆì§¸ ë°°ì—´ì˜ ê°’ ëª¨ë‘ ê°€ì ¸ì˜¤ëŠ”ë° jspì—ì„œ ì´ë¦„ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼í•˜ë‹ˆ ë°‘ì— ì²˜ëŸ¼ ì´ë¦„ë„ ì•„ì˜ˆ ë„£ì–´ì£¼ì.  
    		model.addAttribute("deptTermsList",deptTermsList.get(0).getDeptName());
    	}
    	
    	return "/signup/signupKej2";
    }
    // ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ 
    @GetMapping("/signup/signupKej2List")
    public String signupKej2List(Model model, SignupVOKej signupVOKej) {
    	List<SignupVOKej> SignupSelectList = signupServiceKej.SignupSelectList(signupVOKej);
    	model.addAttribute("SignupSelectList",SignupSelectList);
    	model.addAttribute("signupVOKej2",signupVOKej);
    	return "/signup/signupKej2List";
    }
    
//    @PostMapping("/signupKej2")
//    public String signupInsertKej(SignupVOKej signupVOKej, @RequestParam(value="action", required =true ) String action){
//    	
//    	if("insert".equals(action)) {
//    	//user í…Œì´ë¸”ì— insert í•˜ê¸°
//	      int insertSignup = signupServiceKej.insertSignup(signupVOKej);
//    	}
//	    return  "/signup/signupKej";
//    }
    @PostMapping("/signup/insertFinishKej2")
    //íšŒì› ê°€ì… ê¸°ëŠ¥
    public String signupInsertFinish2(Model model, SignupVOKej signupVOKej) {
    	
    	// ì¸ì„œíŠ¸ ë©”ì„œë“œ ë³€ìˆ˜ì— ë‹´ê¸° (ê¸°ë³¸ê°’ : ì •ìƒì‹¤í–‰ì‹œ 1, ì‹¤íŒ¨ì‹œ ë‹¤ë¥¸ ìˆ˜)
    	int count = signupServiceKej.insertSignup2(signupVOKej);
    	String url = "";
    	
    	//ì„±ê³µì‹œ ë©”ì„¸ì§€+ê²½ë¡œë³´ë‚´ê³ , ì‹¤íŒ¨ì¸ ê²½ìš° ë©”ì„¸ì§€ ë³´ë‚´ê¸°
    	if(count == 1 ) {
    		//int insert = signupServiceKej.insertSignup2(signupVOKej);
    		model.addAttribute("msg","ì¶•í•˜í•©ë‹ˆë‹¤.ğŸ‰íšŒì› ê°€ì…ì´ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.ğŸ˜Š");
    		model.addAttribute("url","/signup/signupKej2List");
    		url = "/signup/signupMsgKej";
    	}else if(count == 0) { //ì „í™”ë²ˆí˜¸ê°€ í‹€ë ¸ì„ë•Œ 
    		model.addAttribute("msg","íšŒì› ê°€ì… ì‹¤íŒ¨ì…ë‹ˆë‹¤..ã… ã…  ì „í™”ë²ˆí˜¸ ë‹¤ì‹œ ì‘ì„± í•˜ì„¸ìš”!!ğŸ˜¢");
    	}else if(count == -1) { // ì•„ì´ë””ê°€ í‹€ë ¸ì„ë•Œ
    		model.addAttribute("msg","íšŒì› ê°€ì… ì‹¤íŒ¨ì…ë‹ˆë‹¤..ã… ã…  ì•„ì´ë””ë¥¼ ë‹¤ì‹œ ì‘ì„± í•˜ì„¸ìš”!!ğŸ˜¢");
    	}else if(count == -2) { // ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì„ë•Œ
    		model.addAttribute("msg","íšŒì› ê°€ì… ì‹¤íŒ¨ì…ë‹ˆë‹¤..ã… ã…  ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì‘ì„± í•˜ì„¸ìš”!!ğŸ˜¢");
    	}else if(count == -3) { // ì£¼ì†Œ í•œê¸€ë§Œ ì…ë ¥ê°€ëŠ¥í•œë° ê·¸ ì™¸ì— ì…ë ¥ë˜ì—ˆì„ë•Œ
    		model.addAttribute("msg","íšŒì› ê°€ì… ì‹¤íŒ¨ì…ë‹ˆë‹¤..ã… ã…  ì£¼ì†Œë¥¼ ë‹¤ì‹œ ì‘ì„± í•˜ì„¸ìš”!!ğŸ˜¢");
    	}else if(count == -4) {
    		model.addAttribute("msg","íšŒì› ê°€ì… ì‹¤íŒ¨ì…ë‹ˆë‹¤..ã… ã…  ì„±ë³„ ì²´í¬ë¥¼ í•˜ì…”ì•¼í•©ë‹ˆë‹¤!!!ğŸ˜¢");
    		
    	}
    	// ì‹¤íŒ¨ì¸ ê²½ìš° ê²½ë¡œ,dept  ë³´ì—¬ì¤„ê²ƒ 
    	if(count != 1) {
    		model.addAttribute("signupVOKej",signupVOKej);
    		//model.addAttribute("url","/signup/signupKej2");
    		
    		// DEPT í…Œì´ë¸”ì—ì„œ ì»¬ëŸ¼ëª…ì´ dept_grp ì´ê³  ê·¸ ê°’ì´ signup_question ì¸ ì§ˆë¬¸ ê°€ì ¸ì˜¤ê¸°
        	DeptVO deptVO = new DeptVO();
        	// voì— ì§ˆë¬¸ ì»¬ëŸ¼ ê°’ì„ ë„£ìŒ   	
        	deptVO.setDeptGrp("signup_question");
        	//ë¦¬ìŠ¤íŠ¸ ë©”ì†Œë“œ í˜¸ì¶œ
        	List<DeptVO> deptQuestionList =  deptService.selectDeptList(deptVO);
        	model.addAttribute("deptQuestionList",deptQuestionList);
        	
        	// DEPT í…Œì´ë¸”ì—ì„œ whereì ˆ dept_grp =  signup_phoneì „í™”ë²ˆí˜¸ ì•ìë¦¬ ê°€ì ¸ì˜¤ê¸°
        	deptVO = new DeptVO();
        	deptVO.setDeptGrp("signup_phone");
        	List<DeptVO> deptTelList = deptService.selectDeptList(deptVO);
        	model.addAttribute("deptTelList",deptTelList);
        	
        	// DEPT í…Œì´ë¸”ì—ì„œ where ì¡°ê±´ dept_grp = signup_terms ì•½ê´€ ì•ìë¦¬ ê°€ì ¸ì˜¤ê¸°
        	deptVO = new DeptVO();
        	deptVO.setDeptGrp("signup_terms");
        	List<DeptVO> deptTermsList = deptService.selectDeptList(deptVO);
        	// ë¦¬ìŠ¤íŠ¸ê°€ ê°€ì§„ ê²ƒ ì¤‘ì—ì„œë„ ì»¬ëŸ¼ëª…ì´ dept_name ì´ê±° ì¸ ê²ƒë§Œ ê°€ì ¸ì˜¤ê¸°
        	if(deptTermsList.size() > 0) {
        		// deptTermsList.get(0) ì´ë ‡ê²Œ ê°€ì ¸ì˜¤ë©´ 0ë²ˆì§¸ ë°°ì—´ì˜ ê°’ ëª¨ë‘ ê°€ì ¸ì˜¤ëŠ”ë° jspì—ì„œ ì´ë¦„ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼í•˜ë‹ˆ ë°‘ì— ì²˜ëŸ¼ ì´ë¦„ë„ ì•„ì˜ˆ ë„£ì–´ì£¼ì.  
        		model.addAttribute("deptTermsList",deptTermsList.get(0).getDeptName());
        	}
    		url = "/signup/signupKej2";
    	}
		/*
		 * String tIYn = signupVOKej.getTermsInfoYn(); String n= "N";
		 * if("".equals(tIYn)||tIYn == null) { System.out.println("ë„ì´ì•¼");
		 * signupVOKej.setTermsInfoYn("n"); }
		 * System.out.println("tIYn"+tIYn+"--------------------------------------");
		 */
    	//return "/signup/signupMsgKej";
    	return url;
    }
    
    
    
}
